OTA Upgrade Cluster.

ZR -  Router - OTA Upgrade client
ZC  - Coordinator - OTA Upgrade server

Flash layout setup at server (ZC):
FW image is at Flash B from address 0x103000.
Must load OTA image file generated by create_image utility (from .bin FW).
Use load_custom_firmware_flash_b_4srv.bat script to load it into ZC
flash. Run load_custom_firmware_flash_b_4srv.bat ota_ncs_client.ota.

Flash layout at client (ZR):
a) Before first OTA
Actual FW image is at Flash A from address 0x3000.
 ZR run from Flash A.
If use DSR's scripts for jlink.exe, load .bin file: load_custom_firmware.bat ota_ncs_client.bin.

b) After first successful OTA
Actual FW image is at Flash B from address 0x103000.
FW image is described by FIB placed at Flash A at address 0x2000. FIB
has two records. Second record points to 0x103000.
Bootloaded remaps flash A-B and run FW from (remapped) 0x3000.

c) After second successful OTA
Actual FW image is at Flash A from address 0x3000.
FW image is described by FIB placed at Flash A at address 0x2000. FIB
has three records. Third record points to 0x3000.
Bootloaded run FW from 0x3000.

d) ....


Prepare steps
1.  Compile 3 binaries: old ZR (OTA Client), new ZR (could be same as
old ZR), ZC (OTA server).
2.  Generate OTA image from new ZR .bin using create_image.exe utility, for example:
./create_image.exe ota_ncs_client.bin ota_ncs_client.ota v1211 0xdead 0x0012
where file version == 0x01020101, manufacturer code == 0xdead, image_type == 0x0012.
Flash OTA image to ZC (OTA server) Flash B using load_custom_firmware_flash_b_4srv.bat script:
load_custom_firmware_flash_b_4srv.bat ota_ncs_client.ota
3.  Flush bootloader at ZR using load_bootloader.bat script
4.  Flush FW images at ZR and ZC using load_custom_firmware.bat script
5.  Start air sniffer
6.  Start win_com_dump observing trace logs for ZR
7.  Start ZC. Wait for Permit Joining Request.
8.  Start ZR not later than 20 seconds after ZC startup.
9.  ZR connect to network. Note: ZC sends OTA Image Notify 20 sec after startup, ZR should join before this moment.
10.  The ZR should initiate the process to search for the OTA upgrade server,
    by issuing a match descriptor request.  

Test steps

1.  ZC informed ZR about file with  manufacturer ID and Image Type ID = ZR value. 
2.  ZR send Query Next Image request to ZC with its manufacturer ID, Image Type ID, and current firmware version.  
3.  ZC send Query Next Image response with a status code of SUCCESS.      
4.  ZR start the download process by issuing an Image Block Request. Manufacturer ID, Image Type ID, firmware version from previous request. File offset = zero.  The maximum data size shall be set by the client.    
5.  ZC send Image Block Response.   
6.  ZR send Upgrade End Request command. 
7.  ZC send Upgrade End Response command.
8.  ZR waits for 10s then reboots
9.  Using debug trace ensure ZR rebooted and now run at flash B (A-B
remapped). Seek trace for "Flash A-B remapped 1".


Note: this test server can also be used as an OTA server for Smart Plug
test included into that SDK.
