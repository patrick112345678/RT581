# TP-PRO-BV-02 (ZigBee Document 07-5035-07)

# gZC address (wpan.src64): aa:aa:aa:aa:aa:aa:aa:aa
# gZC short address (): 0x0000
# DUT ZED1 address (wpan.src64): 00:00:00:00:00:00:00:01
# DUT ZED2 address (wpan.src64): 00:00:00:00:00:00:00:02
# PAN id (wpan.dst_pan): -

# Pass verdict:

# Pre-steps: ZC startup.
wpan.cmd, Beacon Request, count, 1

# 1 DUT ZED performs startup procedure and joins
# the PAN network with Rx on idle = false.
# 1.1 DUT ZED1 shall issue a MLME_Beacon Request MAC command
# frame, and gZC shall respond with beacon.
wpan.cmd, Beacon Request, count, 1
wpan, Beacon, zbee_beacon.ext_panid, aa:aa:aa:aa:aa:aa:aa:aa, wpan.src16, 0x00000000, wpan.assoc_permit, True

# 1.2 Based on the active scan result DUT ZR is able to complete the MAC
# association sequence with gZC and gets new short address from
# Coordinator (Generated in a random manner within the range 1 to
# 0xFFF7)
wpan.cmd, Association Request, wpan.src64, 00:00:00:00:00:00:00:01
wpan.cmd, Association Response, wpan.src64, aa:aa:aa:aa:aa:aa:aa:aa, wpan.dst64, 00:00:00:00:00:00:00:01, wpan.assoc.status, 0x00000000, delta_time, -2

# 1.3 DUT ZED1 issues device Announcement to the network.
zbee_aps.zdp_cluster, Device Announcement, zbee_zdp.ext_addr, 00:00:00:00:00:00:00:01

# 1.4 DUT ZED1 polls gZC and receives message with interval as defined
# by stack profile (say 7.5 seconds).
wpan.cmd, Data Request, wpan.src64, 00:00:00:00:00:00:00:01, wpan.dst16, 0x00000000, delta_time, -7.5, count, -1, parallel, y

# 2 DUT ZED performs startup procedure and joins
# the PAN network with Rx on idle = True.
# 2.5 DUT ZED2 shall issue a MLME_Beacon Request MAC command
# frame, and gZC shall respond with beacon.
wpan.cmd, Beacon Request, count, 1
wpan, Beacon, zbee_beacon.ext_panid, aa:aa:aa:aa:aa:aa:aa:aa, wpan.src16, 0x00000000, wpan.assoc_permit, True

# 2.6 Based on the active scan result DUT ZED2 is able to complete the
# MAC association sequence with gZC and gets new short address from
# Coordinator (Generated in a random manner within the range 1 to
# 0xFFF7).
wpan.cmd, Association Request, wpan.src64, 00:00:00:00:00:00:00:02
wpan.cmd, Association Response, wpan.src64, aa:aa:aa:aa:aa:aa:aa:aa, wpan.dst64, 00:00:00:00:00:00:00:02, wpan.assoc.status, 0x00000000

# 2.7 DUT ZED2 issues device Announcement to the gZC.
zbee_aps.zdp_cluster, 0x00000013, zbee_zdp.ext_addr, 00:00:00:00:00:00:00:02

# Optional: Link Status (alive) check for ZC
zbee_nwk.cmd.id, 0x00000008, zbee_nwk.src64, aa:aa:aa:aa:aa:aa:aa:aa, parallel, y
